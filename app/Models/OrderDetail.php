<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\DB;

class OrderDetail extends Model
{
    use HasFactory;

    public static function get_order_per_item($id_order){
        // ambil data item berdasarkan id_order
        $items = DB::table('orders')
            ->where('orders.id', $id_order)
            ->join('order_details', 'orders.id', '=', 'order_details.id_order')
            ->join('produk_details', 'order_details.id_produk_detail', '=', 'produk_details.id')
            ->get();
        
        // tampung id produks ke array baru
        $id_produk = [];
        foreach($items as $item){
            array_push($id_produk, $item->id_produk);
        }

        // hilangkan duplikat pada array $id_produk
        $id_produk = array_values(array_unique($id_produk));

        // ambil list produk_detail berdasarkan id_produk
        $a = [];
        $list_size_produk_diorder = [];
        foreach($id_produk as $produk_single){
            $a = DB::table('produk_details')
                ->select('produk_details.id as id_produk_detail', 'produks.nama_produk', 'produk_details.size')
                ->where('produk_details.id_produk', $produk_single)
                ->join('produks', 'produk_details.id_produk', '=', 'produks.id')
                ->get();
            array_push($list_size_produk_diorder, $a);
        }

        // buat array baru untuk simpan detail pemesanan
        $detail_order = [];
        foreach($items as $item){
            array_push($detail_order, [$item->id_produk_detail, $item->jumlah_produk]);
        }

        // tambah index 'pesanan' 0 di array
        foreach($list_size_produk_diorder as $list_produk){
            foreach($list_produk as $list_size){
                $list_size->pesanan = "0";
            }
        }

        // input order ke array $list_size_produk_diorder
        // cek jika ada id_produk_detail
        foreach($detail_order as $order){
            $id_produk_detail = $order[0];
            $jumlah_pesanan = $order[1];

            // loop telusuri list size
            // jika id_detail_produk sama
            // push jumlah pesanan
            foreach($list_size_produk_diorder as $list_produk){
                foreach($list_produk as $list_size){
                    if($list_size->id_produk_detail == $id_produk_detail){
                        $list_size->pesanan = (string)$jumlah_pesanan;
                    }
                }
            }
        }
        
        // dd($list_size_produk_diorder);

        // return data
        return collect(json_decode(json_encode($list_size_produk_diorder), true));
    }

    public static function get_order_detail_item_id($id){
        $itemArr = [
            // nama pembeli
            'nama' => '',
        
            // Sancu New Dolphin
            // 21
            '1' => '0',
            // 24
            '2' => '0',
            // 28
            '3' => '0',
            // 30
            '4' => '0',
            // 32
            '5' => '0',
            // 34
            '6' => '0',
            // 36
            '7' => '0',
            // 38
            '8' => '0',
            // 40
            '9' => '0',
            // 42
            '10' => '0',
            // SUM
            'SUM1' => '=SUM(B1:K1)',
            // -------------------------
            // Sancu Samurai
            // 21
            '11' => '0',
            // 24
            '12' => '0',
            // 28
            '13' => '0',
            // 30
            '14' => '0',
            // 32
            '15' => '0',
            // 34
            '16' => '0',
            // 36
            '17' => '0',
            // 38
            '18' => '0',
            // 40
            '19' => '0',
            // 42
            '20' => '0',
            // SUM
            'SUM2' => '=SUM(M1:V1)',
            // -------------------------
            // Sancu Kodok Hijau
            // 21
            '21' => '0',
            // 24
            '22' => '0',
            // 28
            '23' => '0',
            // 30
            '24' => '0',
            // 32
            '25' => '0',
            // 34
            '26' => '0',
            // 36
            '27' => '0',
            // 38
            '28' => '0',
            // 40
            '29' => '0',
            // 42
            '30' => '0',
            // SUM
            'SUM3' => '=SUM(X1:AG1)',
            // -------------------------
            // Sancu Finger Boy
            // 21
            '31' => '0',
            // 24
            '32' => '0',
            // 28
            '33' => '0',
            // 30
            '34' => '0',
            // 32
            '35' => '0',
            // 34
            '36' => '0',
            // 36
            '37' => '0',
            // 38
            '38' => '0',
            // 40
            '39' => '0',
            // 42
            '40' => '0',
            // SUM
            'SUM4' => '=SUM(AI1:AR1)',
            // -------------------------
            // Sancu Sheep Putih
            // 21
            '41' => '0',
            // 24
            '42' => '0',
            // 28
            '43' => '0',
            // 30
            '44' => '0',
            // 32
            '45' => '0',
            // 34
            '46' => '0',
            // 36
            '47' => '0',
            // 38
            '48' => '0',
            // 40
            '49' => '0',
            // 42
            '50' => '0',
            // SUM
            'SUM5' => '=SUM(AT1:BC1)',
            // -------------------------
            // Sancu Blue Cars
            // 21
            '51' => '0',
            // 24
            '52' => '0',
            // 28
            '53' => '0',
            // 30
            '54' => '0',
            // 32
            '55' => '0',
            // 34
            '56' => '0',
            // 36
            '57' => '0',
            // 38
            '58' => '0',
            // 40
            '59' => '0',
            // 42
            '60' => '0',
            // SUM
            'SUM6' => '=SUM(BE1:BN1)',
            // -------------------------
            // Sancu Topcop
            // 21
            '61' => '0',
            // 24
            '62' => '0',
            // 28
            '63' => '0',
            // 30
            '64' => '0',
            // 32
            '65' => '0',
            // 34
            '66' => '0',
            // 36
            '67' => '0',
            // 38
            '68' => '0',
            // 40
            '69' => '0',
            // 42
            '70' => '0',
            // SUM
            'SUM7' => '=SUM(BP1:BY1)',
            // -------------------------
            // Sancu Pika-Pika
            // 21
            '71' => '0',
            // 24
            '72' => '0',
            // 28
            '73' => '0',
            // 30
            '74' => '0',
            // 32
            '75' => '0',
            // 34
            '76' => '0',
            // 36
            '77' => '0',
            // 38
            '78' => '0',
            // 40
            '79' => '0',
            // 42
            '80' => '0',
            // SUM
            'SUM8' => '=SUM(CA1:CJ1)',
            // -------------------------
            // Sancu Hudson Jesica
            // 21
            '81' => '0',
            // 24
            '82' => '0',
            // 28
            '83' => '0',
            // 30
            '84' => '0',
            // 32
            '85' => '0',
            // 34
            '86' => '0',
            // 36
            '87' => '0',
            // 38
            '88' => '0',
            // 40
            '89' => '0',
            // 42
            '90' => '0',
            // SUM
            'SUM9' => '=SUM(CL1:CU1)',
            // -------------------------
            // Sancu Oshin
            // 21
            // '91' => '0',
            // // 24
            // '92' => '0',
            // // 28
            // '93' => '0',
            // // 30
            // '94' => '0',
            // // 32
            // '95' => '0',
            // // 34
            // '96' => '0',
            // 36
            '97' => '0',
            // 38
            '98' => '0',
            // 40
            '99' => '0',
            // // 42
            // '100' => '0',
            // SUM
            'SUM10' => '=SUM(CW1:CY1)',
            // -------------------------
            // Sancu Nusa
            // 21
            '101' => '0',
            // 24
            '102' => '0',
            // 28
            '103' => '0',
            // 30
            '104' => '0',
            // 32
            '105' => '0',
            // 34
            '106' => '0',
            // 36
            '107' => '0',
            // 38
            '108' => '0',
            // 40
            '109' => '0',
            // 42
            '110' => '0',
            // SUM
            'SUM11' => '=SUM(DA1:DJ1)',
            // -------------------------
            // Sancu Robot Merah (Iron Man)
            // 21
            '111' => '0',
            // 24
            '112' => '0',
            // 28
            '113' => '0',
            // 30
            '114' => '0',
            // 32
            '115' => '0',
            // 34
            '116' => '0',
            // 36
            '117' => '0',
            // 38
            '118' => '0',
            // 40
            '119' => '0',
            // 42
            '120' => '0',
            // SUM
            'SUM12' => '=SUM(DL1:DU1)',
            // -------------------------
            // Sancu George Monkey
            // 21
            '121' => '0',
            // 24
            '122' => '0',
            // 28
            '123' => '0',
            // 30
            '124' => '0',
            // 32
            '125' => '0',
            // 34
            '126' => '0',
            // 36
            '127' => '0',
            // 38
            '128' => '0',
            // 40
            '129' => '0',
            // 42
            '130' => '0',
            // SUM
            'SUM13' => '=SUM(DW1:EF1)',
            // -------------------------
            // Sancu Doraemon
            // 21
            '131' => '0',
            // 24
            '132' => '0',
            // 28
            '133' => '0',
            // 30
            '134' => '0',
            // 32
            '135' => '0',
            // 34
            '136' => '0',
            // 36
            '137' => '0',
            // 38
            '138' => '0',
            // 40
            '139' => '0',
            // 42
            '140' => '0',
            // SUM
            'SUM14' => '=SUM(EH1:EQ1)',
            // -------------------------
            // Sancu Red Cars
            // 21
            '141' => '0',
            // 24
            '142' => '0',
            // 28
            '143' => '0',
            // 30
            '144' => '0',
            // 32
            '145' => '0',
            // 34
            '146' => '0',
            // 36
            '147' => '0',
            // 38
            '148' => '0',
            // 40
            '149' => '0',
            // 42
            '150' => '0',
            // SUM
            'SUM15' => '=SUM(ES1:FB1)',
            // -------------------------
            // Sancu Sponge Bob
            // 21
            '151' => '0',
            // 24
            '152' => '0',
            // 28
            '153' => '0',
            // 30
            '154' => '0',
            // 32
            '155' => '0',
            // 34
            '156' => '0',
            // 36
            '157' => '0',
            // 38
            '158' => '0',
            // 40
            '159' => '0',
            // 42
            '160' => '0',
            // SUM
            'SUM16' => '=SUM(FD1:FM1)',
            // -------------------------
            // Sancu Boboy Boy
            // 21
            '161' => '0',
            // 24
            '162' => '0',
            // 28
            '163' => '0',
            // 30
            '164' => '0',
            // 32
            '165' => '0',
            // 34
            '166' => '0',
            // 36
            '167' => '0',
            // 38
            '168' => '0',
            // 40
            '169' => '0',
            // 42
            '170' => '0',
            // SUM
            'SUM17' => '=SUM(FO1:FX1)',
            // -------------------------
            // Sancu Baby Girl Pink
            // 21
            '171' => '0',
            // 24
            '172' => '0',
            // 28
            '173' => '0',
            // 30
            '174' => '0',
            // 32
            '175' => '0',
            // 34
            '176' => '0',
            // 36
            '177' => '0',
            // 38
            '178' => '0',
            // 40
            '179' => '0',
            // 42
            '180' => '0',
            // SUM
            'SUM18' => '=SUM(FZ1:GI1)',
            // -------------------------
            // Sancu Kitty Ungu
            // 21
            '181' => '0',
            // 24
            '182' => '0',
            // 28
            '183' => '0',
            // 30
            '184' => '0',
            // 32
            '185' => '0',
            // 34
            '186' => '0',
            // 36
            '187' => '0',
            // 38
            '188' => '0',
            // 40
            '189' => '0',
            // 42
            '190' => '0',
            // SUM
            'SUM19' => '=SUM(GK1:GT1)',
            // -------------------------
            // Sancu Kitty Merah
            // 21
            '191' => '0',
            // 24
            '192' => '0',
            // 28
            '193' => '0',
            // 30
            '194' => '0',
            // 32
            '195' => '0',
            // 34
            '196' => '0',
            // 36
            '197' => '0',
            // 38
            '198' => '0',
            // 40
            '199' => '0',
            // 42
            '200' => '0',
            // SUM
            'SUM20' => '=SUM(GV1:HE1)',
            // -------------------------
            // Sancu Spidy
            // 21
            '201' => '0',
            // 24
            '202' => '0',
            // 28
            '203' => '0',
            // 30
            '204' => '0',
            // 32
            '205' => '0',
            // 34
            '206' => '0',
            // 36
            '207' => '0',
            // 38
            '208' => '0',
            // 40
            '209' => '0',
            // 42
            '210' => '0',
            // SUM
            'SUM21' => '=SUM(HG1:HP1)',
            // -------------------------
            // Sancu Ninja Boy
            // 21
            '211' => '0',
            // 24
            '212' => '0',
            // 28
            '213' => '0',
            // 30
            '214' => '0',
            // 32
            '215' => '0',
            // 34
            '216' => '0',
            // 36
            '217' => '0',
            // 38
            '218' => '0',
            // 40
            '219' => '0',
            // 42
            '220' => '0',
            // SUM
            'SUM22' => '=SUM(HR1:IA1)',
            // -------------------------
            // Sancu Baby Girl Ungu
            // 21
            '221' => '0',
            // 24
            '222' => '0',
            // 28
            '223' => '0',
            // 30
            '224' => '0',
            // 32
            '225' => '0',
            // 34
            '226' => '0',
            // 36
            '227' => '0',
            // 38
            '228' => '0',
            // 40
            '229' => '0',
            // 42
            '230' => '0',
            // SUM
            'SUM23' => '=SUM(IC1:IL1)',
            // -------------------------
            // Sancu Baby Bear
            // 21
            '231' => '0',
            // 24
            '232' => '0',
            // 28
            '233' => '0',
            // 30
            '234' => '0',
            // 32
            '235' => '0',
            // 34
            '236' => '0',
            // 36
            '237' => '0',
            // 38
            '238' => '0',
            // 40
            '239' => '0',
            // 42
            '240' => '0',
            // SUM
            'SUM24' => '=SUM(IN1:IW1)',
            // -------------------------
            // Sancu Marsha Little Girl
            // 21
            '241' => '0',
            // 24
            '242' => '0',
            // 28
            '243' => '0',
            // 30
            '244' => '0',
            // 32
            '245' => '0',
            // 34
            '246' => '0',
            // 36
            '247' => '0',
            // 38
            '248' => '0',
            // 40
            '249' => '0',
            // 42
            '250' => '0',
            // SUM
            'SUM25' => '=SUM(IY1:JH1)',
            // -------------------------
            // Sancu Frozen/Princess
            // 21
            '251' => '0',
            // 24
            '252' => '0',
            // 28
            '253' => '0',
            // 30
            '254' => '0',
            // 32
            '255' => '0',
            // 34
            '256' => '0',
            // 36
            '257' => '0',
            // 38
            '258' => '0',
            // 40
            '259' => '0',
            // 42
            '260' => '0',
            // SUM
            'SUM26' => '=SUM(JJ1:JS1)',
            // -------------------------
            // Sancu Bang Jarwo
            // 21
            '261' => '0',
            // 24
            '262' => '0',
            // 28
            '263' => '0',
            // 30
            '264' => '0',
            // 32
            '265' => '0',
            // 34
            '266' => '0',
            // 36
            '267' => '0',
            // 38
            '268' => '0',
            // 40
            '269' => '0',
            // 42
            '270' => '0',
            // SUM
            'SUM27' => '=SUM(JU1:KD1)',
            // -------------------------
            // Sancu Gatot Kaca
            // 21
            '271' => '0',
            // 24
            '272' => '0',
            // 28
            '273' => '0',
            // 30
            '274' => '0',
            // 32
            '275' => '0',
            // 34
            '276' => '0',
            // 36
            '277' => '0',
            // 38
            '278' => '0',
            // 40
            '279' => '0',
            // 42
            '280' => '0',
            // SUM
            'SUM28' => '=SUM(KF1:KO1)',
            // -------------------------
            // Sancu Thomas/Train
            // 21
            '281' => '0',
            // 24
            '282' => '0',
            // 28
            '283' => '0',
            // 30
            '284' => '0',
            // 32
            '285' => '0',
            // 34
            '286' => '0',
            // 36
            '287' => '0',
            // 38
            '288' => '0',
            // 40
            '289' => '0',
            // 42
            '290' => '0',
            // SUM
            'SUM29' => '=SUM(KQ1:KZ1)',
            // -------------------------
            // Sancu Dino
            // 21
            '291' => '0',
            // 24
            '292' => '0',
            // 28
            '293' => '0',
            // 30
            '294' => '0',
            // 32
            '295' => '0',
            // 34
            '296' => '0',
            // 36
            '297' => '0',
            // 38
            '298' => '0',
            // 40
            '299' => '0',
            // 42
            '300' => '0',
            // SUM
            'SUM30' => '=SUM(LB1:LK1)',
            // -------------------------
            // Sancu Superman
            // 21
            '301' => '0',
            // 24
            '302' => '0',
            // 28
            '303' => '0',
            // 30
            '304' => '0',
            // 32
            '305' => '0',
            // 34
            '306' => '0',
            // 36
            '307' => '0',
            // 38
            '308' => '0',
            // 40
            '309' => '0',
            // 42
            '310' => '0',
            // SUM
            'SUM31' => '=SUM(LM1:LV1)',
            // -------------------------
            // Sancu Batman
            // 21
            '311' => '0',
            // 24
            '312' => '0',
            // 28
            '313' => '0',
            // 30
            '314' => '0',
            // 32
            '315' => '0',
            // 34
            '316' => '0',
            // 36
            '317' => '0',
            // 38
            '318' => '0',
            // 40
            '319' => '0',
            // 42
            '320' => '0',
            // SUM
            'SUM32' => '=SUM(LX1:MG1)',
            // -------------------------
            // Sancu Little Pony Ungu
            // 21
            '321' => '0',
            // 24
            '322' => '0',
            // 28
            '323' => '0',
            // 30
            '324' => '0',
            // 32
            '325' => '0',
            // 34
            '326' => '0',
            // 36
            '327' => '0',
            // 38
            '328' => '0',
            // 40
            '329' => '0',
            // 42
            '330' => '0',
            // SUM
            'SUM33' => '=SUM(MI1:MR1)',
            // -------------------------
            // Sancu Silvia Sancu
            // 21
            '331' => '0',
            // 24
            '332' => '0',
            // 28
            '333' => '0',
            // 30
            '334' => '0',
            // 32
            '335' => '0',
            // 34
            '336' => '0',
            // 36
            '337' => '0',
            // 38
            '338' => '0',
            // 40
            '339' => '0',
            // 42
            '340' => '0',
            // SUM
            'SUM34' => '=SUM(MT1:NC1)',
            // -------------------------
            // Sancu Udin Idin
            // 21
            '341' => '0',
            // 24
            '342' => '0',
            // 28
            '343' => '0',
            // 30
            '344' => '0',
            // 32
            '345' => '0',
            // 34
            '346' => '0',
            // 36
            '347' => '0',
            // 38
            '348' => '0',
            // 40
            '349' => '0',
            // 42
            '350' => '0',
            // SUM
            'SUM35' => '=SUM(NE1:NN1)',
            // -------------------------
            // Sancu Little Bus / Tayo
            // 21
            '351' => '0',
            // 24
            '352' => '0',
            // 28
            '353' => '0',
            // 30
            '354' => '0',
            // 32
            '355' => '0',
            // 34
            '356' => '0',
            // 36
            '357' => '0',
            // 38
            '358' => '0',
            // 40
            '359' => '0',
            // 42
            '360' => '0',
            // SUM
            'SUM36' => '=SUM(NP1:NY1)',
            // -------------------------
        ];

        // ambil data orderan
        $dataOrderDetail = DB::table('orders')
            ->select('orders.id', 'orders.ongkir', 'order_details.id_produk_detail', 'order_details.jumlah_produk', 'users.name')
            ->where('orders.id', $id)
            ->join('order_details', 'orders.id', '=', 'order_details.id_order')
            ->join('users', 'orders.id_user', '=', 'users.id')
            ->get();
        
        // input nama
        $itemArr['nama'] = $dataOrderDetail[0]->name;

        // cek id_order_details
        // apakah ada di itemArr
        for($i=0; $i<count($dataOrderDetail); $i++){
            if(array_key_exists($dataOrderDetail[$i]->id_produk_detail, $itemArr)){
                $itemArr[$dataOrderDetail[$i]->id_produk_detail] = $dataOrderDetail[$i]->jumlah_produk;
            }
        }

        return collect([$itemArr]);
        // return $itemArr;
    }
}

